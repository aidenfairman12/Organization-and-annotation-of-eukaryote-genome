# TE Circos Plot Analysis

This document explains how to generate circular plots showing the distribution of transposable elements (TEs) across your genome assembly.

## Overview

The analysis generates two types of circos plots:

1. **All TE Superfamilies Plot**: Shows the distribution of all abundant TE superfamilies across the genome
2. **Centromeric TEs Plot**: Highlights Athila and CRM clades, which are known centromeric markers in Brassicaceae

## Files Created

- `03_TE_circos_plots.R` - Main R script that generates the plots
- `03_TE_circos_plots.slurm` - SLURM submission script for running on the cluster

## Prerequisites

The following files must exist (generated by previous steps):

1. `assembly.fasta.mod.EDTA.TEanno.gff3` - TE annotations from EDTA
2. `assembly.fasta.fai` - FASTA index file with scaffold lengths
3. `assembly.fasta.mod.LTR.intact.raw.fa.rexdb-plant.cls.tsv` - TEsorter clade classifications

All these files are already available in your `results/edta_output/` directory.

## How to Run

### Option 1: Submit to SLURM (Recommended)

```bash
cd /data/users/afairman/euk_org_ann/scripts
sbatch 03_TE_circos_plots.slurm
```

### Option 2: Run interactively

```bash
cd /data/users/afairman/euk_org_ann/scripts
module load R/4.3.1
Rscript 03_TE_circos_plots.R
```

## Output Files

Plots will be saved to `/data/users/afairman/euk_org_ann/plots/`:

- `03_TE_density_all_superfamilies.pdf` - Circos plot with all major TE superfamilies
- `03_TE_density_centromeric.pdf` - Circos plot highlighting Athila and CRM clades

## What the Script Does

### 1. Load Data
- Reads TE annotations from the EDTA GFF3 file
- Reads scaffold lengths from the FAI index file
- Loads TEsorter clade classifications

### 2. Prepare Data
- Identifies the 20 longest scaffolds (pseudo-chromosomes)
- Filters TE annotations to keep only abundant superfamilies
- Extracts Athila and CRM clade elements from TEsorter results

### 3. Generate Plots
- Creates circular plots with each scaffold as a segment
- Plots TE density in sliding windows (100 kb)
- Uses distinct colors for each TE superfamily
- Adds legends and scaffold labels

### 4. Visualization Features
- **Track height**: 0.06-0.08 (adjustable)
- **Window size**: 100 kb (1e5 bp)
- **Gaps**: Scaffolds separated by 1°, with 5° gap at the end
- **Starting position**: 90° (top of circle)

## Customization Options

You can modify the R script to:

### Change number of scaffolds displayed
```r
# Line 93: Change from 20 to your desired number
custom_ideogram <- custom_ideogram[1:20, ]
```

### Adjust minimum TE count threshold
```r
# Line 121: Change minimum number of elements
filter(n >= 50)  # Change 50 to higher/lower value
```

### Modify window size for density calculation
```r
# Line 238: Change window size (currently 100 kb)
window.size = 1e5  # Try 5e4 for 50kb or 2e5 for 200kb
```

### Adjust track height
```r
# Line 238: Change track height
track.height = 0.06  # Try 0.08 for thicker or 0.04 for thinner tracks
```

### Change color scheme
```r
# Lines 138-150: Modify the te_colors vector with your preferred colors
```

## Understanding the Output

### All TE Superfamilies Plot
- Each concentric ring represents one TE superfamily
- Height of bars indicates TE density in that genomic region
- Colors distinguish different TE types
- Outer labels show scaffold names

### Centromeric TEs Plot
- Shows Gypsy and Copia (all elements) as reference
- Highlights Athila and CRM clades in distinct colors
- Athila and CRM clustering may indicate centromeric regions
- Useful for identifying putative centromere locations

## Interpreting TE Distributions

- **Clustered TEs**: May indicate heterochromatic regions
- **Athila/CRM hotspots**: Potential centromeric regions
- **Even distribution**: Euchromatic regions
- **Sparse regions**: Gene-rich areas or recent assembly gaps

## Troubleshooting

### "No Athila or CRM elements found"
- Run TEsorter first: `sbatch 02_TEsorter_clade_classification.sh`
- Check that TEsorter completed successfully

### "TE annotation GFF3 file not found"
- Ensure EDTA completed successfully
- Check: `/data/users/afairman/euk_org_ann/results/edta_output/assembly.fasta.mod.EDTA.TEanno.gff3`

### R package errors
- The script requires: circlize, tidyverse, ComplexHeatmap
- These should be available in the R/4.3.1 module
- If not, install them: `install.packages(c("circlize", "tidyverse", "ComplexHeatmap"))`

## Next Steps

After generating the plots:

1. Examine the TE distribution patterns
2. Identify potential centromeric regions (Athila/CRM clusters)
3. Compare TE density with gene annotation (if available)
4. Use patterns to inform downstream analyses

## Questions?

If you have questions about:
- Modifying plot parameters
- Interpreting results
- Adding additional TE types
- Changing visualization style

Feel free to ask!
